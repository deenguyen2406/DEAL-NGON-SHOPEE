<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh S√°ch Deal</title>
    <link rel="icon" type="image/png" href="shopee-icon.png">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <header class="header">
            <a href="index.html" class="back-btn">‚Üê Quay l·∫°i</a>
            <h1 id="pageTitle">ƒêang t·∫£i...</h1>
            <p id="pageSubtitle">ƒêang t·∫£i d·ªØ li·ªáu...</p>
        </header>

        <main id="dealList">
            <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c render t·ª´ file data.js -->
        </main>

        <footer class="footer">
            <a href="index.html" class="btn btn-secondary"
                style="margin-bottom: 10px; display: inline-flex; width: auto;">‚Üê Quay l·∫°i trang ch·ªß</a>
            <p>IP c·ªßa b·∫°n: <span id="userIP">ƒêang t·∫£i...</span></p>
        </footer>
    </div>

    <!-- 1. Load data -->
    <script src="data.js"></script>

    <!-- 2. Main Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // L·∫•y tham s·ªë 'id' t·ª´ URL (v√≠ d·ª•: ?id=iphone)
            const urlParams = new URLSearchParams(window.location.search);
            const categoryId = urlParams.get('id');

            // Ki·ªÉm tra xem ID c√≥ h·ª£p l·ªá kh√¥ng
            if (!categoryId || !DEAL_DATA[categoryId]) {
                document.getElementById('pageTitle').textContent = "‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y trang";
                document.getElementById('pageSubtitle').textContent = "Vui l√≤ng quay l·∫°i trang ch·ªß.";
                return;
            }

            // L·∫•y d·ªØ li·ªáu
            const data = DEAL_DATA[categoryId];

            // 1. C·∫≠p nh·∫≠t Header
            document.title = data.title;
            document.getElementById('pageTitle').textContent = data.title;
            document.getElementById('pageSubtitle').textContent = data.subtitle;

            // 2. Render Deal List
            const dealListEl = document.getElementById('dealList');
            dealListEl.innerHTML = ''; // X√≥a n·ªôi dung c≈© (n·∫øu c√≥)

            data.items.forEach(item => {
                // N·∫øu l√† Header ch·ªâ c√≥ text (d√†nh cho m·ª•c MacBook & Kh√°c)
                if (item.header) {
                    const headerEl = document.createElement('div');
                    headerEl.className = 'section-header';
                    headerEl.textContent = item.header;
                    dealListEl.appendChild(headerEl);
                    return;
                }

                // T·∫°o th·∫ª Card
                const card = document.createElement('div');
                card.className = 'deal-card';

                // Title
                if (item.title) {
                    const titleEl = document.createElement('div');
                    titleEl.className = 'deal-title';
                    titleEl.textContent = item.title;
                    card.appendChild(titleEl);
                }

                // Price
                if (item.price) {
                    const priceEl = document.createElement('div');
                    priceEl.className = 'deal-price';
                    priceEl.textContent = item.price;
                    card.appendChild(priceEl);
                }

                // Custom Content (HTML t·ª± do - d√†nh cho m·ª•c ph·ª©c t·∫°p nh∆∞ iPhone 17)
                if (item.customContent) {
                    const div = document.createElement('div');
                    div.innerHTML = item.customContent;
                    card.appendChild(div);
                }

                // Links
                if (item.links && item.links.length > 0) {
                    item.links.forEach(link => {
                        const a = document.createElement('a');
                        a.href = link.url;
                        a.className = 'shop-link';
                        a.target = '_blank';

                        if (link.name.toLowerCase().includes('link shopee') || link.name.startsWith('üëâ') || link.name.startsWith('Link Shopee')) {
                            // N·∫øu t√™n l√† "Link Shopee" ho·∫∑c icon th√¨ hi·ªÉn th·ªã tr·ª±c ti·∫øp
                            a.innerHTML = link.name;
                        } else {
                            // Format: Shop Name: Link Shopee
                            a.innerHTML = `<span class="shop-name">${link.name}:</span> Link Shopee`;
                        }

                        card.appendChild(a);
                    });
                }

                // Note
                if (item.note) {
                    const noteEl = document.createElement('div');
                    noteEl.className = 'note';
                    noteEl.style = "margin-top: 5px; color: #dc3545; font-size: 0.9em;"; // Style inline cho nhanh
                    noteEl.textContent = item.note;
                    card.appendChild(noteEl);
                }

                dealListEl.appendChild(card);
            });

            // 3. Fake IP Logic (Gi·ªØ l·∫°i t·ª´ code c≈©)
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    if (data.ip) {
                        document.getElementById('userIP').textContent = data.ip;
                        document.getElementById('userIP').style.color = '#28a745';
                    }
                })
                .catch(() => {
                    document.getElementById('userIP').textContent = 'Error';
                });
        });
    </script>
</body>

</html>